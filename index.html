<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Reminder v5.5.2</title> 
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <link rel="apple-touch-icon" href="icon-192.png">

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

    <style>
        /* ê¸°ë³¸ ì„¤ì • */
        html { font-size: 15px; }
        body { 
            font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif; 
            background-color: #ffffff; 
            margin: 0; padding: 0; color: #111; 
        }

        .container { 
            width: 100%; max-width: 945px; margin: 0 auto; 
            background: white; min-height: 100vh; 
            box-shadow: 0 0 20px rgba(0,0,0,0.05); 
            position: relative; overflow-x: hidden; 
        }
        
        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        header { 
            background-color: #000000; color: white; padding: 10px 15px; 
            text-align: center; position: sticky; top: 0; z-index: 50; 
            display: flex; justify-content: space-between; align-items: center;
            height: 60px; box-sizing: border-box; 
        }
        header h1 { 
            margin: 0; font-size: 1.1rem; font-weight: 700; letter-spacing: 1px; 
            position: absolute; left: 50%; transform: translateX(-50%); white-space: nowrap; pointer-events: none;
        }

        /* ì™¼ìª½ ëŒ€ì‹œë³´ë“œ ë²„íŠ¼ */
        .header-left-btn {
            background: #333; border: 1px solid #555; color: white; cursor: pointer; 
            font-size: 0.9rem; padding: 6px 12px; display: flex; align-items: center; gap: 8px;
            transition: 0.2s; border-radius: 20px; font-weight: normal; font-family: inherit;
        }
        .header-left-btn:hover { background-color: #555; }
        
        .dashboard-icon { width: 18px; height: 18px; fill: currentColor; }

        /* ì˜¤ë¥¸ìª½ í”„ë¡œí•„ ì˜ì—­ */
        .profile-container { position: relative; }

        .profile-avatar-btn {
            width: 36px; height: 36px; border-radius: 50%; 
            background-color: #ef5350; 
            color: white; border: 2px solid #333; 
            font-weight: bold; font-size: 1rem;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .profile-avatar-btn:hover { border-color: #fff; }

        /* êµ¬ê¸€ ìŠ¤íƒ€ì¼ ë“œë¡­ë‹¤ìš´ íŒì—… */
        .profile-dropdown {
            display: none; 
            position: absolute; 
            top: 50px; right: -10px; 
            width: 320px; 
            background-color: #e9eef6; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            border-radius: 28px; 
            padding: 10px;
            text-align: center;
            z-index: 100;
            color: #333;
            cursor: default; 
        }
        .profile-dropdown.show { display: block; animation: popIn 0.2s ease-out; }
        @keyframes popIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        .pop-header { position: relative; padding: 10px; padding-bottom: 5px; }
        .pop-close-btn { position: absolute; top: 5px; right: 10px; background: none; border: none; font-size: 1.2rem; cursor: pointer; color: #555; }
        .pop-email { font-size: 0.85rem; color: #444; margin-bottom: 15px; font-weight: 500;}
        
        .pop-big-avatar { 
            width: 70px; height: 70px; background: #ef5350; color: white; 
            border-radius: 50%; font-size: 2rem; font-weight: bold; 
            display: flex; justify-content: center; align-items: center; 
            margin: 0 auto 10px auto; 
            position: relative;
        }
        /* [ìˆ˜ì •ë¨ v5.5.2] ë²„íŠ¼ì´ ì‚¬ë¼ì¡Œìœ¼ë¯€ë¡œ ì•„ë˜ìª½ ì—¬ë°±(margin-bottom)ì„ ë„‰ë„‰í•˜ê²Œ ì¡°ì • (15px -> 25px) */
        .pop-greeting { font-size: 1.1rem; color: #202124; margin-bottom: 25px; font-weight: 400; }
        
        /* [ì‚­ì œë¨ v5.5.2] .pop-manage-btn ê´€ë ¨ ìŠ¤íƒ€ì¼ ì‚­ì œ */

        .pop-menu-list {
            background: white; border-radius: 20px; overflow: hidden;
            display: flex; flex-direction: column;
        }
        .pop-menu-item {
            background: white; border: none; width: 100%; text-align: left;
            padding: 15px 20px; font-size: 0.9rem; color: #3c4043;
            cursor: pointer; border-bottom: 1px solid #f1f3f4;
            display: flex; align-items: center; gap: 15px; 
            font-family: inherit;
        }
        .pop-menu-item:last-child { border-bottom: none; }
        .pop-menu-item:hover { background-color: #f5f5f5; }
        
        .pop-svg { 
            width: 20px; height: 20px; 
            fill: #5f6368; 
        }


        /* ê¸°ì¡´ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .back-btn { background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer; padding: 5px; z-index: 20;}

        /* í•„í„° ë°” */
        .filter-bar { display: flex; flex-wrap: wrap; gap: 8px; padding: 15px 20px; background: white; border-bottom: 1px solid #f5f5f5; }
        .filter-btn { white-space: nowrap; padding: 6px 12px; border-radius: 5px; border: 1px solid #f0f0f0; background: #fff; color: #555; font-size: 0.9rem; font-weight: 350; cursor: pointer; transition: 0.2s; font-family: inherit; }
        .filter-btn.active { background: #000; color: #fff; border-color: #000; box-shadow: 0 2px 5px rgba(0,0,0,0.2); font-weight: bold; }

        /* ë¦¬ìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤ ì˜ì—­ */
        .list-controls { 
            padding: 10px 20px 0 20px; 
            background: white; 
            display: flex; 
            justify-content: flex-end;
            align-items: center;
        }
        
        .control-btn { 
            background: none; 
            border: 1px solid #ddd; 
            padding: 6px 14px; 
            font-size: 0.85rem; 
            border-radius: 15px; 
            color: #666; 
            cursor: pointer; 
            transition: 0.2s; 
            display: flex;
            align-items: center;
            justify-content: center; 
            gap: 6px; 
            min-width: 110px; 
        }
        .control-btn:hover { background: #f5f5f5; color: #000; border-color: #bbb; }
        .control-btn.active { background: #000; color: #fff; border-color: #000; }

        .btn-icon { width: 16px; height: 16px; fill: currentColor; }

        /* ë¡œê·¸ì¸, ë¡œë”© í™”ë©´ */
        #login-screen { text-align: center; padding: 50px 20px; }
        .login-card { background: white; padding: 40px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .google-btn { background: #000; color: white; border: none; padding: 12px 20px; border-radius: 5px; font-size: 1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; width: 100%; margin-top: 20px;}
        
        #loading-screen { position: fixed; top:0; left:0; width:100%; height:100%; background:white; z-index: 999; display: flex; justify-content: center; align-items: center; flex-direction: column;}
        .loader { border: 5px solid #f3f3f3; border-top: 5px solid #000; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 10px;}
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* íƒ­ ë°” */
        .tab-bar { display: flex; background: #fff; border-bottom: 1px solid #eee; }
        .tab-btn { flex: 1; padding: 15px; border: none; background: white; cursor: pointer; font-weight: bold; color: #aaa; border-bottom: 2px solid transparent; transition: 0.3s; }
        .tab-btn.active { color: #000; border-bottom: 2px solid #000; }
        
        .list-container { padding: 20px; padding-bottom: 90px; }

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card { 
            background: white; border: 1px solid #eee; border-radius: 12px; padding: 20px; padding-top: 30px; padding-bottom: 45px; margin-bottom: 15px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.03); cursor: pointer; transition: 0.3s; 
            display: flex; justify-content: space-between; align-items: center; position: relative; 
        }
        .card:hover { transform: translateY(-3px); box-shadow: 0 6px 15px rgba(0,0,0,0.06); }
        .card.sortable-ghost { opacity: 0.4; background: #f0f0f0; border: 2px dashed #ccc; }
        .container.editing-mode .card { margin-right: 40px; }

        .drag-handle { position: absolute; right: -40px; top: 0; bottom: 0; width: 40px; display: none; justify-content: center; align-items: center; cursor: grab; color: #bbb; font-size: 1.5rem; }
        .drag-handle:hover { color: #333; }
        .container.editing-mode .drag-handle { display: flex; }

        .card.completed { background-color: #f9f9f9; border-color: #eee; opacity: 0.8; }
        .completed-badge { position: absolute; top: 0; right: 0; background: #ef5350; color: white; font-size: 0.7rem; font-weight: bold; padding: 4px 12px; border-radius: 0 12px 0 10px; z-index: 5; box-shadow: -1px 1px 3px rgba(0,0,0,0.1); }

        .card-title { font-weight: 700; font-size: 1.1rem; color: #000; }
        .card.completed .card-title { color: #888; text-decoration: line-through; }

        .category-badge { position: absolute; top: 0; left: 0; z-index: 5; font-size: 0.7rem; font-weight: bold; padding: 4px 10px; border-radius: 12px 0 10px 0; color: white; background-color: #000; box-shadow: 1px 1px 3px rgba(0,0,0,0.1); letter-spacing: 0.5px; }

        .goal-date { position: absolute; bottom: 12px; right: 20px; font-size: 0.75rem; color: #999; font-weight: 400; }
        .card.completed .goal-date { color: #ef5350; font-weight: bold; }
        
        .total-time-badge { position: absolute; bottom: 12px; left: 20px; font-size: 0.8rem; color: #1976d2; font-weight: bold; display: flex; align-items: center; gap: 4px; }

        .icon-btn { background: none; border: none; cursor: pointer; padding: 8px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; transition: background-color 0.2s; color: #bbb; }
        .icon-btn:hover { background-color: #f0f0f0; color: #000; }
        .icon-svg { width: 20px; height: 20px; fill: currentColor; }

        .card-actions { display: flex; gap: 2px; }

        /* ê¸°ë¡ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .record-card { padding: 18px; margin-bottom: 12px; border-radius: 12px; border-left: 4px solid #ddd; background-color: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .style-smile { border-left-color: #2e7d32; }   
        .style-neutral { border-left-color: #f9a825; } 
        .style-sad { border-left-color: #c62828; }     

        .record-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; color: #888; font-size: 0.85rem; font-weight: normal; }
        .record-time-badge { display: inline-block; background: #e3f2fd; color: #1565c0; font-size: 0.75rem; padding: 2px 6px; border-radius: 4px; font-weight: bold; margin-left: 8px; vertical-align: middle; }

        .record-content { display: flex; align-items: flex-start; }
        .emoji-display { font-size: 1.8rem; margin-right: 15px; line-height: 1.2; }
        .record-text { font-size: 1rem; color: #333; line-height: 1.4; flex: 1; white-space: pre-wrap; }
        
        .subgoal-tags { margin-top: 15px; padding-top: 10px; border-top: 1px dashed #f0f0f0; display: flex; flex-wrap: wrap; gap: 6px; width: 100%; }
        .subgoal-tag { background: #f5f5f5; color: #555; font-size: 0.75rem; padding: 4px 10px; border-radius: 20px; font-weight: normal; border: 1px solid #eee; }

        /* FAB ë²„íŠ¼ */
        .fab-btn { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background-color: #000; color: white; border: none; border-radius: 50px; padding: 16px 32px; font-size: 1rem; font-weight: bold; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2); cursor: pointer; width: max-content; transition: 0.2s; z-index: 50;}
        .fab-btn:hover { background-color: #333; transform: translateX(-50%) scale(1.05); }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(2px); justify-content: center; align-items: center; z-index: 100; }
        .modal-content { background: white; padding: 30px; border-radius: 0; width: 85%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); max-height: 90vh; overflow-y: auto;}
        
        .modal select { width: 100%; padding: 12px; margin: 10px 0; box-sizing: border-box; border: 1px solid #ddd; border-radius: 0; font-family: inherit; background: white; -webkit-appearance: none; appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 10px center; background-size: 16px; }
        .modal input[type="text"], .modal input[type="date"], .modal input[type="number"], .modal textarea { width: 100%; padding: 12px; margin: 10px 0 10px 0; box-sizing: border-box; border: 1px solid #ddd; border-radius: 0; font-family: inherit; }
        .modal input:focus, .modal textarea:focus, .modal select:focus { outline: none; border-color: #000; }

        /* í•˜ìœ„ ëª©í‘œ UI */
        .subgoal-input-group { display: flex; gap: 5px; margin-bottom: 10px; }
        .subgoal-input-group input { margin: 0 !important; }
        .btn-add-sub { background: #000; color: white; border: none; border-radius: 0; padding: 0 15px; cursor: pointer; font-weight: bold; font-size: 1.2rem;}
        
        .subgoal-list-ui { list-style: none; padding: 0; margin: 0 0 20px 0; }
        .subgoal-item-ui { display: flex; justify-content: space-between; align-items: center; background: #fff; border-bottom:1px solid #eee; padding: 8px 5px; margin-bottom: 0; font-size: 0.9rem; cursor: move; } 
        .subgoal-item-ui.sortable-ghost { background: #f9f9f9; opacity: 0.5; }
        .subgoal-drag-handle { margin-right: 10px; color: #ccc; cursor: grab; }
        .subgoal-edit-name { flex: 1; margin: 0 !important; padding: 8px !important; border: 1px solid transparent !important; border-radius: 4px; background: transparent; }
        .subgoal-edit-name:focus { border-color: #ddd !important; background: #f9f9f9; }
        .subgoal-item-ui button { background: none; border: none; color: #999; cursor: pointer; font-weight: bold; padding: 0 10px; }
        .subgoal-item-ui button:hover { color: #000; }
        
        /* í† ê¸€ ë“± ì„¤ì • UI */
        .complete-toggle-area { margin-top: 20px; padding: 15px; background: #fafafa; border: 1px solid #eee; border-radius: 8px 8px 0 0; display: flex; align-items: center; justify-content: space-between; }
        .complete-toggle-area.open { border-bottom: none; border-radius: 8px 8px 0 0; }
        .complete-toggle-area:not(.open) { border-radius: 8px; }

        .setting-toggle-area { margin-top: 10px; padding: 15px; background: #fff; border: 1px solid #eee; border-radius: 8px; display: flex; align-items: center; justify-content: space-between; }

        .complete-toggle-label { font-weight: bold; font-size: 0.95rem; color: #000; }
        .complete-toggle-sub { font-size: 0.8rem; color: #888; margin-top: 3px;}
        
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #ef5350; } 
        input:checked + .slider:before { transform: translateX(24px); }
        input:checked + .slider.blue { background-color: #1976d2; }

        #goal-end-date-container { display: none; padding: 15px; background: #fafafa; border: 1px solid #eee; border-top: none; border-radius: 0 0 8px 8px; animation: slideDown 0.2s ease-out; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        .time-input-wrapper { display: flex; align-items: center; gap: 10px; margin-top: 5px; }
        .time-input-wrapper div { flex: 1; display: flex; align-items: center; gap: 5px; }
        .time-input-wrapper span { white-space: nowrap; font-size: 0.9rem; }
        .time-input-wrapper input { text-align: right; }

        .check-group { margin-bottom: 15px; background: #fff; padding: 5px; border: 1px solid #eee; }
        .check-item { display: flex; align-items: center; margin-bottom: 8px; cursor: pointer; padding: 5px;}
        .check-item:last-child { margin-bottom: 0; }
        .check-item input { margin-right: 10px; width: 18px; height: 18px; cursor: pointer; accent-color: #000; }
        .check-item span { font-size: 0.95rem; }

        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        .btn-group button { flex: 1; padding: 12px; border-radius: 0; border: none; cursor: pointer; font-weight: bold;}
        .btn-save { background: #000; color: white; }
        .btn-cancel { background: #f0f0f0; color: #333; }
        
        /* ì´ëª¨ì§€ ì„ íƒê¸° */
        .emoji-selector { display: flex; justify-content: space-around; margin: 20px 0; }
        .emoji-option { font-size: 2.2rem; opacity: 0.3; cursor: pointer; transition: 0.2s;}
        .emoji-option.selected { opacity: 1; transform: scale(1.2); }

        /* ìº˜ë¦°ë” ìŠ¤íƒ€ì¼ */
        .calendar-controls { display: flex; justify-content: space-between; align-items: center; padding: 20px 25px; background: #fff; }
        .cal-btn { background: none; border: 1px solid #ddd; padding: 5px 12px; border-radius: 0; cursor: pointer; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; }
        .cal-header { padding: 15px 0; font-weight: bold; color: #000; font-size: 0.8rem; }
        
        .cal-day { 
            height: 70px; border-top: 1px solid #f5f5f5; position: relative; padding-top: 8px; cursor: pointer; transition: background-color 0.2s;
        }
        .cal-day:hover { background-color: #f9f9f9; }

        .cal-day:nth-child(7n) { color: #5c6bc0; }   
        .cal-day:nth-child(7n+1) { color: #ef5350; } 
        .cal-date-num { font-size: 0.8rem; color: #ccc; position: absolute; top: 8px; left: 8px;}
        .cal-day:nth-child(7n) .cal-date-num, .cal-day:nth-child(7n+1) .cal-date-num { color: inherit; opacity: 0.7; }
        .cal-emoji { font-size: 1.8rem; position: absolute; top: 55%; left: 50%; transform: translate(-50%, -50%); }
        .cal-time { font-size: 0.65rem; color: #1976d2; position: absolute; top: 8px; right: 4px; font-weight: bold; }
        .calendar-summary { padding: 20px; background: #fafafa; border-top: 1px solid #eee; margin-top: 10px; margin-bottom: 80px; border-radius: 0 0 12px 12px; font-size: 0.9rem; color: #444; }
        .summary-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .summary-item:last-child { margin-bottom: 0; }
        .summary-label { font-weight: bold; color: #888; font-size: 0.85rem; }
        .summary-value { font-weight: bold; color: #000; }
        .summary-value.time { color: #1976d2; }
        .summary-value.date { color: #555; font-weight: normal; font-size: 0.85rem;}

        /* ëŒ€ì‹œë³´ë“œ í…Œì´ë¸” */
        .dash-table-wrapper { overflow-x: auto; padding-bottom: 30px; background: #fff; border-bottom: 1px solid #eee; }
        .dash-table { border-collapse: collapse; width: 100%; min-width: 800px; }
        .dash-table th, .dash-table td { border: 1px solid #eee; padding: 10px; text-align: center; font-size: 0.9rem; }
        .dash-table th { background-color: #fafafa; font-weight: bold; color: #555; min-width: 30px; }
        .sticky-col { position: sticky; left: 0; background-color: #fff; z-index: 5; border-right: 2px solid #ddd !important; text-align: left !important; min-width: 120px; box-shadow: 2px 0 5px rgba(0,0,0,0.05); cursor: pointer; transition: background-color 0.2s; }
        .sticky-col:hover { background-color: #f0f0f0; }
        .dash-table th.sticky-col { background-color: #fafafa; z-index: 6; cursor: default; }
        .dash-goal-name { font-weight: bold; display: block; margin-bottom: 4px; color: #333; }
        .dash-total-time { font-size: 0.75rem; color: #1976d2; font-weight: bold; }
        .dash-emoji { font-size: 1.2rem; }
        .dash-clickable-cell { cursor: pointer; transition: 0.2s; }
        .dash-clickable-cell:hover { background-color: #f0f0f0; }

    </style>
</head>
<body>

<div id="loading-screen">
    <div class="loader"></div>
    <div>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</div>
</div>

<div class="container" id="main-container">

    <div id="login-screen" style="display: none;">
        <div class="login-card">
            <h1>Reminder</h1>
            <p style="color:#666">ìŠê¸° ì‰¬ìš´ ë‚˜ì˜ ë‹¤ì§ì„<br>ì‘ì€ ëª©í‘œë“¤ë¡œ ì‹¤ì²œí•´ë³´ì„¸ìš”.</p>
            <button class="google-btn" onclick="googleLogin()">
                G êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ì‹œì‘í•˜ê¸°
            </button>
        </div>
    </div>

    <div id="screen-dashboard" style="display: none;">
        <header>
            <button class="back-btn" onclick="showScreen('goal')">â—€</button>
            <h1>ëŒ€ì‹œë³´ë“œ</h1>
            <div style="width: 30px;"></div>
        </header>

        <div class="calendar-controls">
            <button class="cal-btn" onclick="changeDashMonth(-1)">â—€</button>
            <span id="dash-year-month" style="font-weight:bold; font-size:1.1rem;"></span>
            <button class="cal-btn" onclick="changeDashMonth(1)">â–¶</button>
        </div>

        <div class="dash-table-wrapper">
            <table class="dash-table" id="dash-table"></table>
        </div>
        <div style="padding: 20px; color:#999; font-size:0.8rem; text-align: center;">
            ëª©í‘œ ì´ë¦„ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ë‚´ì—­ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.<br>
            ì¹¸ì„ í´ë¦­í•˜ì—¬ ê²°ê³¼ë¥¼ ê¸°ë¡í•˜ê±°ë‚˜ ìˆ˜ì •í•˜ì„¸ìš”.
        </div>
    </div>

    <div id="screen-goal-list" style="display: none;">
        <header>
            <button class="header-left-btn" onclick="showScreen('dashboard')">
                <svg class="dashboard-icon" viewBox="0 0 24 24">
                    <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                </svg>
                <span>ëŒ€ì‹œë³´ë“œ</span>
            </button>

            <h1>REMINDER</h1>

            <div class="profile-container">
                <button class="profile-avatar-btn" id="header-avatar-btn" onclick="toggleProfileMenu()">
                    ?
                </button>
                
                <div class="profile-dropdown" id="profile-dropdown-menu">
                    <div class="pop-header">
                        <div class="pop-email" id="pop-email-text">user@email.com</div>
                        <button class="pop-close-btn" onclick="toggleProfileMenu()">Ã—</button>
                    </div>

                    <div class="pop-big-avatar" id="pop-big-avatar">?</div>
                    <div class="pop-greeting" id="pop-greeting">ì•ˆë…•í•˜ì„¸ìš”, Userë‹˜.</div>
                    
                    <div class="pop-menu-list">
                        <button class="pop-menu-item" onclick="googleLogin()">
                            <svg class="pop-svg" viewBox="0 0 24 24">
                                <path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                            </svg>
                            <span>ë‹¤ë¥¸ ê³„ì • ì¶”ê°€</span>
                        </button>
                        <button class="pop-menu-item" onclick="googleLogout()">
                            <svg class="pop-svg" viewBox="0 0 24 24">
                                <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                            </svg>
                            <span>ëª¨ë“  ê³„ì •ì—ì„œ ë¡œê·¸ì•„ì›ƒ</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="filter-bar">
            <button class="filter-btn active" id="filter-all" onclick="selectGoalFilter('all')">ì „ì²´</button>
            <button class="filter-btn" id="filter-ê±´ê°•" onclick="selectGoalFilter('ê±´ê°•')">ê±´ê°•</button>
            <button class="filter-btn" id="filter-ìê¸°ê³„ë°œ" onclick="selectGoalFilter('ìê¸°ê³„ë°œ')">ìê¸°ê³„ë°œ</button>
            <button class="filter-btn" id="filter-ì—…ë¬´" onclick="selectGoalFilter('ì—…ë¬´')">ì—…ë¬´/í•™ì—…</button>
            <button class="filter-btn" id="filter-ìì‚°" onclick="selectGoalFilter('ìì‚°')">ìì‚°ê´€ë¦¬</button>
            <button class="filter-btn" id="filter-ìƒí™œ" onclick="selectGoalFilter('ìƒí™œ')">ìƒí™œìŠµê´€</button>
            <button class="filter-btn" id="filter-ì·¨ë¯¸" onclick="selectGoalFilter('ì·¨ë¯¸')">ì·¨ë¯¸/ì—¬ê°€</button>
            <button class="filter-btn" id="filter-ìœ¡ì•„" onclick="selectGoalFilter('ìœ¡ì•„')">ìœ¡ì•„</button>
            <button class="filter-btn" id="filter-ê¸°íƒ€" onclick="selectGoalFilter('ê¸°íƒ€')">ê¸°íƒ€</button>
        </div>

        <div class="list-controls">
            <button id="edit-order-btn" class="control-btn" onclick="toggleEditMode()">
                <svg class="btn-icon" viewBox="0 0 24 24">
                    <path d="M7 20h2V8h3L8 4 4 8h3v12zm13-4h-3V4h-2v12h-3l4 4 4-4z"/>
                </svg>
                <span>ìˆœì„œ ë³€ê²½</span>
            </button>
        </div>

        <div class="list-container" id="goal-list-container"></div>
        <button class="fab-btn" onclick="openGoalModal()">+ ìƒˆ ëª©í‘œ ì¶”ê°€</button>
    </div>

    <div id="screen-record-list" style="display: none;">
        <header>
            <button class="back-btn" onclick="showScreen('goal')">â—€</button>
            <h1 id="record-title-text">ë¦¬ë§ˆì¸ë”</h1>
            <div style="width: 30px;"></div> 
        </header>
        
        <div class="tab-bar">
            <button class="tab-btn active" id="tab-list-btn" onclick="switchTab('list')">ë¦¬ìŠ¤íŠ¸</button>
            <button class="tab-btn" id="tab-cal-btn" onclick="switchTab('calendar')">ìº˜ë¦°ë”</button>
        </div>

        <div id="view-list">
            <div class="list-container" id="record-list-container"></div>
        </div>

        <div id="view-calendar" style="display:none;">
            <div class="calendar-controls">
                <button class="cal-btn" onclick="changeMonth(-1)">â—€</button>
                <span id="cal-year-month" style="font-weight:bold; font-size:1.1rem;"></span>
                <button class="cal-btn" onclick="changeMonth(1)">â–¶</button>
            </div>
            <div class="calendar-grid" style="border-bottom:1px solid #eee;">
                <div class="cal-header" style="color:#ef5350;">ì¼</div>
                <div class="cal-header">ì›”</div>
                <div class="cal-header">í™”</div>
                <div class="cal-header">ìˆ˜</div>
                <div class="cal-header">ëª©</div>
                <div class="cal-header">ê¸ˆ</div>
                <div class="cal-header" style="color:#5c6bc0;">í† </div>
            </div>
            <div class="calendar-grid" id="calendar-body"></div>
            <div id="calendar-summary" class="calendar-summary"></div>
        </div>

        <button class="fab-btn" onclick="openRecordModal()">+ ì˜¤ëŠ˜ ê²°ê³¼ ê¸°ë¡</button>
    </div>

</div>

<div id="modal-goal" class="modal">
    <div class="modal-content">
        <h3>ë¦¬ë§ˆì¸ë” ì„¤ì •</h3>
        <input type="hidden" id="goal-id-input">
        
        <label style="font-weight:bold; font-size:0.9rem;">ì¹´í…Œê³ ë¦¬</label>
        <select id="goal-category-input">
            <option value="ê±´ê°•">ğŸ’ª ê±´ê°• (Health)</option>
            <option value="ìê¸°ê³„ë°œ">ğŸ“š ìê¸°ê³„ë°œ (Growth)</option>
            <option value="ì—…ë¬´">ğŸ’¼ ì—…ë¬´/í•™ì—… (Work)</option>
            <option value="ìì‚°">ğŸ’° ìì‚°ê´€ë¦¬ (Money)</option>
            <option value="ìƒí™œ">ğŸ  ìƒí™œìŠµê´€ (Life)</option>
            <option value="ì·¨ë¯¸">ğŸ¨ ì·¨ë¯¸/ì—¬ê°€ (Hobby)</option>
            <option value="ìœ¡ì•„">ğŸ‘¶ ìœ¡ì•„ (Parenting)</option>
            <option value="ê¸°íƒ€">âœ¨ ê¸°íƒ€ (Etc)</option>
        </select>

        <label style="font-weight:bold; font-size:0.9rem; margin-top:10px; display:block;">ëª©í‘œ ì‹œì‘ì¼</label>
        <input type="date" id="goal-start-date-input">

        <div style="display:flex; gap:10px; margin-bottom:10px;">
            <div style="flex:1;">
                <label style="font-weight:bold; font-size:0.9rem;">ëª©í‘œ ì´ë¦„</label>
                <input type="text" id="goal-name-input" placeholder="ì˜ˆ: ì²´ì¤‘ ê°ëŸ‰í•˜ê¸°"> 
            </div>
        </div>
        
        <div class="setting-toggle-area">
            <div>
                <div class="complete-toggle-label">â±ï¸ íˆ¬ì ì‹œê°„ ê³„ì‚°</div>
                <div class="complete-toggle-sub">ì´ ëª©í‘œì— ì“´ ì‹œê°„ì„ ê¸°ë¡í• ê¹Œìš”?</div>
            </div>
            <label class="switch">
                <input type="checkbox" id="goal-time-toggle">
                <span class="slider blue"></span>
            </label>
        </div>

        <label style="font-weight:bold; font-size:0.9rem; margin-top:15px; display:block;">í•˜ìœ„ ì‹¤ì²œ ëª©í‘œ</label>
        <div class="subgoal-input-group">
            <input type="text" id="subgoal-temp-input" placeholder="ì˜ˆ: ë°¤ì— ë¨¹ì§€ ì•Šê¸°" style="flex:1;">
            <button class="btn-add-sub" onclick="addTempSubGoal()">+</button>
        </div>
        <ul id="subgoal-list-ui" class="subgoal-list-ui"></ul>

        <div class="complete-toggle-area" id="complete-toggle-area" style="display:none;">
            <div>
                <div class="complete-toggle-label">ğŸ‰ ëª©í‘œ ë‹¬ì„± ì™„ë£Œ!</div>
                <div class="complete-toggle-sub">ë” ì´ìƒ ë¦¬ë§ˆì¸ë“œê°€ í•„ìš” ì—†ë‚˜ìš”?</div>
            </div>
            <label class="switch">
                <input type="checkbox" id="goal-complete-toggle" onchange="toggleCompleteDate()">
                <span class="slider"></span>
            </label>
        </div>
        <div id="goal-end-date-container">
            <label style="font-weight:bold; font-size:0.9rem; color:#ef5350;">ë‹¬ì„±ì¼</label>
            <input type="date" id="goal-end-date-input">
        </div>

        <div class="btn-group">
            <button class="btn-cancel" onclick="closeModals()">ì·¨ì†Œ</button>
            <button class="btn-save" onclick="saveGoal()">ì €ì¥í•˜ê¸°</button>
        </div>
    </div>
</div>

<div id="modal-record" class="modal">
    <div class="modal-content">
        <h3>ğŸ“ ê²°ê³¼ ê¸°ë¡</h3>
        <input type="hidden" id="record-id-input">
        
        <label style="font-weight:bold; font-size:0.9rem;">ë‚ ì§œ</label>
        <input type="date" id="record-date-input">

        <div id="record-time-input-area" style="display:none; margin-top:10px;">
            <label style="font-weight:bold; font-size:0.9rem; color:#1976d2;">â±ï¸ íˆ¬ì ì‹œê°„</label>
            <div class="time-input-wrapper">
                <div>
                    <input type="number" id="record-time-hour" placeholder="0"> <span>ì‹œê°„</span>
                </div>
                <div>
                    <input type="number" id="record-time-minute" placeholder="0"> <span>ë¶„</span>
                </div>
            </div>
        </div>

        <div id="record-subgoal-area" style="display:none; margin-top:15px;">
            <label style="font-weight:bold; font-size:0.9rem; margin-bottom:5px; display:block;">ì˜¤ëŠ˜ì˜ ë‹¬ì„± í•­ëª©</label>
            <div class="check-group" id="record-check-list">
                </div>
        </div>

        <label style="font-weight:bold; font-size:0.9rem; margin-top:10px; display:block;">ì˜¤ëŠ˜ì˜ ì‹¤ì²œ ê²°ê³¼</label>
        <div class="emoji-selector">
            <span class="emoji-option" onclick="selectEmoji('smile')" id="opt-smile">ğŸ˜„</span>
            <span class="emoji-option" onclick="selectEmoji('neutral')" id="opt-neutral">ğŸ˜</span>
            <span class="emoji-option" onclick="selectEmoji('sad')" id="opt-sad">ğŸ˜­</span>
        </div>
        
        <label style="font-weight:bold; font-size:0.9rem;">ì‹¤ì²œ ì¼ê¸°</label>
        <textarea id="record-diary-input" rows="3" placeholder="ê¸°ë¡í•˜ê³  ì‹¶ì€ ë‚´ìš©ì´ ìˆë‚˜ìš”?"></textarea>
        
        <div class="btn-group">
            <button class="btn-cancel" onclick="closeModals()">ì·¨ì†Œ</button>
            <button class="btn-save" onclick="saveRecord()">ì €ì¥í•˜ê¸°</button>
        </div>
    </div>
</div>

<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./service-worker.js');
        });
    }

    const firebaseConfig = {
        apiKey: "AIzaSyD8kAckZ62IGVc9VdJ8rAyBa2DuOJjQRsA",
        authDomain: "reminder-42a85.firebaseapp.com",
        projectId: "reminder-42a85",
        storageBucket: "reminder-42a85.firebasestorage.app",
        messagingSenderId: "447940194490",
        appId: "1:447940194490:web:eae283179f264d330e1283"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let user = null;            
    let goals = [];             
    let subGoalsMap = {};       
    let records = [];           
    let currentGoalId = null;   
    let currentEmoji = '';      
    let calYear = new Date().getFullYear(); 
    let calMonth = new Date().getMonth();
    let dashYear = new Date().getFullYear();
    let dashMonth = new Date().getMonth();
    let currentGoalFilter = 'all'; 
    let tempSubGoals = [];         
    let isEditMode = false;        
    let goalSortable = null;
    let subGoalSortable = null;

    const ICON_EDIT = `<svg class="icon-svg" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>`;
    const ICON_DELETE = `<svg class="icon-svg" viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>`;

    auth.onAuthStateChanged((currentUser) => {
        document.getElementById('loading-screen').style.display = 'none'; 
        if (currentUser) {
            user = currentUser;
            
            const displayName = user.displayName || "User";
            const email = user.email || "";
            const initial = displayName.charAt(0).toUpperCase();
            
            // í—¤ë” ì•„ë°”íƒ€
            document.getElementById('header-avatar-btn').innerText = initial;
            
            // íŒì—… ë‚´ë¶€ ì •ë³´
            document.getElementById('pop-email-text').innerText = email;
            document.getElementById('pop-big-avatar').innerText = initial;
            document.getElementById('pop-greeting').innerText = `ì•ˆë…•í•˜ì„¸ìš”, ${displayName}ë‹˜.`;

            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('screen-goal-list').style.display = 'block';
            loadDataFromCloud(); 
        } else {
            user = null;
            document.getElementById('login-screen').style.display = 'block';
            document.getElementById('screen-goal-list').style.display = 'none';
            document.getElementById('screen-record-list').style.display = 'none';
            document.getElementById('screen-dashboard').style.display = 'none';
        }
    });

    // í”„ë¡œí•„ ë©”ë‰´ í† ê¸€ í•¨ìˆ˜
    function toggleProfileMenu() {
        const menu = document.getElementById('profile-dropdown-menu');
        menu.classList.toggle('show');
    }

    // í™”ë©´ì˜ ë‹¤ë¥¸ ê³³ì„ í´ë¦­í•˜ë©´ ë©”ë‰´ ë‹«ê¸°
    window.onclick = function(event) {
        if (!event.target.matches('.profile-avatar-btn') && !event.target.closest('.profile-dropdown')) {
            const menu = document.getElementById('profile-dropdown-menu');
            if (menu && menu.classList.contains('show')) {
                menu.classList.remove('show');
            }
        }
        if (event.target.classList.contains('modal')) closeModals();
    }

    function googleLogin() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider).catch((error) => alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + error.message));
    }
    function googleLogout() {
        auth.signOut();
        goals = []; records = []; subGoalsMap = {};
    }

    function loadDataFromCloud() {
        if (!user) return;
        
        db.collection('goals')
          .where("uid", "==", user.uid) 
          .orderBy('order', 'asc')      
          .get()
          .then((qs) => {
            goals = [];
            qs.forEach((doc) => goals.push({ id: doc.id, ...doc.data() }));
            renderGoalList(); 
        })
        .catch((error) => {
            console.error("ëª©í‘œ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error);
        });

        db.collection('subgoals').where("uid", "==", user.uid).get().then((qs) => {
            subGoalsMap = {};
            qs.forEach((doc) => {
                const data = doc.data();
                if(!subGoalsMap[data.goalId]) subGoalsMap[data.goalId] = [];
                subGoalsMap[data.goalId].push({ id: doc.id, ...data });
            });
            renderGoalList(); 
        });

        db.collection('records').where("uid", "==", user.uid).get().then((qs) => {
            records = [];
            qs.forEach((doc) => records.push({ id: doc.id, ...doc.data() }));
            if(document.getElementById('screen-goal-list').style.display === 'block') {
                renderGoalList();
            }
        });
    }

    function toggleEditMode() {
        isEditMode = !isEditMode; 
        const btn = document.getElementById('edit-order-btn');
        const container = document.getElementById('main-container');
        
        if (isEditMode) {
            const iconHtml = `<svg class="btn-icon" viewBox="0 0 24 24"><path d="M7 20h2V8h3L8 4 4 8h3v12zm13-4h-3V4h-2v12h-3l4 4 4-4z"/></svg>`;
            btn.innerHTML = `${iconHtml}<span>í¸ì§‘ ì™„ë£Œ</span>`;
            
            btn.classList.add('active');
            container.classList.add('editing-mode');
        } else {
            const iconHtml = `<svg class="btn-icon" viewBox="0 0 24 24"><path d="M7 20h2V8h3L8 4 4 8h3v12zm13-4h-3V4h-2v12h-3l4 4 4-4z"/></svg>`;
            btn.innerHTML = `${iconHtml}<span>ìˆœì„œ ë³€ê²½</span>`;
            
            btn.classList.remove('active');
            container.classList.remove('editing-mode');
        }
    }

    function selectGoalFilter(category) {
        currentGoalFilter = category;
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.getElementById('filter-' + category).classList.add('active');
        renderGoalList(); 
    }

    function openGoalModal(id = null) {
        document.getElementById('modal-goal').style.display = 'flex';
        
        const nameInput = document.getElementById('goal-name-input');
        const catInput = document.getElementById('goal-category-input'); 
        const dateInput = document.getElementById('goal-start-date-input');
        const idInput = document.getElementById('goal-id-input');
        const completeArea = document.getElementById('complete-toggle-area');
        const completeToggle = document.getElementById('goal-complete-toggle');
        const endDateInput = document.getElementById('goal-end-date-input');
        const timeToggle = document.getElementById('goal-time-toggle'); 

        document.getElementById('subgoal-temp-input').value = '';
        tempSubGoals = []; 

        if (id) {
            const goal = goals.find(g => g.id === id);
            nameInput.value = goal.name;
            catInput.value = goal.category || 'ê¸°íƒ€'; 
            dateInput.value = goal.startDate || new Date().toISOString().substring(0, 10);
            idInput.value = id;
            timeToggle.checked = !!goal.useTimeTracker;
            completeArea.style.display = 'flex';
            
            if (goal.completedAt) {
                completeToggle.checked = true;
                const doneDate = goal.completedAt.toDate ? goal.completedAt.toDate() : new Date(goal.completedAt.seconds * 1000);
                endDateInput.value = doneDate.toISOString().substring(0, 10);
            } else {
                completeToggle.checked = false;
                endDateInput.value = new Date().toISOString().substring(0, 10); 
            }

            if(subGoalsMap[id]) {
                let sortedSubs = [...subGoalsMap[id]].sort((a,b) => (a.order||0) - (b.order||0));
                tempSubGoals = sortedSubs.map(sg => ({...sg, isDeleted: false})); 
            }
        } else { 
            nameInput.value = ''; 
            catInput.value = 'ê¸°íƒ€'; 
            dateInput.value = new Date().toISOString().substring(0, 10); 
            idInput.value = ''; 
            timeToggle.checked = false; 
            completeArea.style.display = 'none';
            completeToggle.checked = false;
            endDateInput.value = new Date().toISOString().substring(0, 10);
        }
        
        toggleCompleteDate();
        renderTempSubGoals();
        
        const el = document.getElementById('subgoal-list-ui');
        if(subGoalSortable) subGoalSortable.destroy();
        subGoalSortable = Sortable.create(el, {
            handle: '.subgoal-drag-handle',
            animation: 150,
            ghostClass: 'sortable-ghost',
            onEnd: function (evt) {
                const itemEl = tempSubGoals[evt.oldIndex];
                tempSubGoals.splice(evt.oldIndex, 1);
                tempSubGoals.splice(evt.newIndex, 0, itemEl);
            },
        });

        nameInput.focus();
    }

    function toggleCompleteDate() {
        const isChecked = document.getElementById('goal-complete-toggle').checked;
        const container = document.getElementById('goal-end-date-container');
        const toggleArea = document.getElementById('complete-toggle-area');
        if (isChecked) {
            container.style.display = 'block';
            toggleArea.classList.add('open');
        } else {
            container.style.display = 'none';
            toggleArea.classList.remove('open');
        }
    }

    function addTempSubGoal() {
        const input = document.getElementById('subgoal-temp-input');
        const val = input.value.trim();
        if(!val) return;
        tempSubGoals.push({ name: val, isNew: true });
        input.value = '';
        renderTempSubGoals();
        input.focus();
    }

    function removeTempSubGoal(index) {
        if(tempSubGoals[index].id) {
            tempSubGoals[index].isDeleted = true; 
        } else {
            tempSubGoals.splice(index, 1); 
        }
        renderTempSubGoals();
    }

    function updateTempSubGoalName(index, newName) {
        tempSubGoals[index].name = newName;
    }

    function renderTempSubGoals() {
        const ul = document.getElementById('subgoal-list-ui');
        ul.innerHTML = '';
        tempSubGoals.forEach((item, idx) => {
            if(item.isDeleted) return; 
            const li = document.createElement('li');
            li.className = 'subgoal-item-ui';
            li.innerHTML = `
                <div style="display:flex; align-items:center; width:100%;">
                    <span class="subgoal-drag-handle">â‰¡</span>
                    <input type="text" class="subgoal-edit-name" value="${item.name}" onchange="updateTempSubGoalName(${idx}, this.value)">
                </div>
                <button onclick="removeTempSubGoal(${idx})">Ã—</button>
            `;
            ul.appendChild(li);
        });
    }

    async function saveGoal() {
        const name = document.getElementById('goal-name-input').value;
        const category = document.getElementById('goal-category-input').value; 
        const startDate = document.getElementById('goal-start-date-input').value;
        const isCompleted = document.getElementById('goal-complete-toggle').checked;
        const endDateVal = document.getElementById('goal-end-date-input').value;
        const useTimeTracker = document.getElementById('goal-time-toggle').checked; 
        const id = document.getElementById('goal-id-input').value;
        
        if (!name) return alert("ëª©í‘œëª…ì„ ì…ë ¥í•˜ì„¸ìš”.");
        
        let goalId = id;
        
        let order = goals.length + 1;
        if(id) {
            const existing = goals.find(g => g.id === id);
            if(existing) order = existing.order;
        }

        const goalData = {
            uid: user.uid, 
            name: name,
            order: order,
            category: category,
            startDate: startDate || new Date().toISOString().substring(0, 10),
            useTimeTracker: useTimeTracker 
        };

        if (id) {
            if (isCompleted && endDateVal) {
                goalData.completedAt = new Date(endDateVal);
            } else {
                goalData.completedAt = null;
            }
        }

        if (goalId) {
            await db.collection('goals').doc(goalId).update(goalData);
        } else {
            goalData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            goalData.completedAt = null; 
            const docRef = await db.collection('goals').add(goalData);
            goalId = docRef.id;
        }

        const batch = db.batch();
        let hasUpdates = false;

        let visibleIndex = 1;
        tempSubGoals.forEach(sg => {
            if (!sg.isDeleted) {
                sg.order = visibleIndex++;
            }
        });

        tempSubGoals.forEach(sg => {
            if (sg.isNew && !sg.isDeleted) {
                const newRef = db.collection('subgoals').doc();
                batch.set(newRef, {
                    uid: user.uid,
                    goalId: goalId,
                    name: sg.name,
                    order: sg.order, 
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                hasUpdates = true;
            } else if (sg.id && sg.isDeleted) { 
                const delRef = db.collection('subgoals').doc(sg.id);
                batch.delete(delRef);
                hasUpdates = true;
            } else if (sg.id && !sg.isDeleted) { 
                const updateRef = db.collection('subgoals').doc(sg.id);
                batch.update(updateRef, {
                    name: sg.name,
                    order: sg.order
                });
                hasUpdates = true;
            }
        });

        if(hasUpdates) await batch.commit();

        loadDataFromCloud();
        closeModals();
    }

    function deleteGoal(id) {
        if (confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ê´€ë ¨ ê¸°ë¡ê³¼ í•˜ìœ„ëª©í‘œê°€ ëª¨ë‘ ì‚¬ë¼ì§‘ë‹ˆë‹¤.")) {
            db.collection('goals').doc(id).delete();
            const relatedRecords = records.filter(r => r.goalId === id);
            relatedRecords.forEach(rec => db.collection('records').doc(rec.id).delete());
            if(subGoalsMap[id]) {
                subGoalsMap[id].forEach(sg => db.collection('subgoals').doc(sg.id).delete());
            }
            setTimeout(loadDataFromCloud, 500);
        }
    }

    function renderGoalList() {
        const container = document.getElementById('goal-list-container');
        container.innerHTML = ''; 
        
        let filteredGoals = goals;
        if (currentGoalFilter !== 'all') {
            filteredGoals = goals.filter(g => g.category === currentGoalFilter);
        }

        if (filteredGoals.length === 0) {
            let msg = 'ë“±ë¡ëœ ëª©í‘œê°€ ì—†ìŠµë‹ˆë‹¤.<br>ìƒˆë¡œìš´ ëª©í‘œë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!';
            if (goals.length > 0 && filteredGoals.length === 0) {
                msg = `í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ëª©í‘œê°€ ì—†ìŠµë‹ˆë‹¤.`;
            }
            container.innerHTML = `<p style="text-align:center; color:#999; margin-top:80px; font-size:0.9rem;">${msg}</p>`;
            return;
        }

        filteredGoals.sort((a,b) => {
            const aDone = !!a.completedAt;
            const bDone = !!b.completedAt;
            if (aDone !== bDone) return aDone ? 1 : -1; 
            return (a.order||0) - (b.order||0);
        });

        filteredGoals.forEach(goal => {
            const div = document.createElement('div');
            div.setAttribute('data-id', goal.id);
            
            const isCompleted = !!goal.completedAt;
            div.className = `card ${isCompleted ? 'completed' : ''}`;
            
            const mySubGoals = subGoalsMap[goal.id] || [];
            let subHtml = '';
            
            if (mySubGoals.length > 0) {
                mySubGoals.sort((a, b) => (a.order || 0) - (b.order || 0));
                const subItems = mySubGoals.map(sg => 
                    `<div style="font-size:0.95rem; color:#555; margin-top:6px; font-weight:400; display:flex; align-items:flex-start;">
                        <span style="color:#aaa; margin-right:6px;">â€¢</span>
                        <span>${sg.name}</span>
                    </div>`
                ).join('');
                subHtml = `<div style="margin-top:12px; padding-top:10px; border-top:1px dashed #eee;">${subItems}</div>`;
            }

            const catName = goal.category || 'ê¸°íƒ€';
            const catBadge = `<div class="category-badge">${catName}</div>`;
            const completedBadgeHtml = isCompleted ? `<div class="completed-badge">ë‹¬ì„±</div>` : '';

            let dateStr = `${goal.startDate || 'ë‚ ì§œë¯¸ì •'} ì‹œì‘`;
            if (isCompleted && goal.completedAt) {
                const dateObj = goal.completedAt.toDate ? goal.completedAt.toDate() : new Date(goal.completedAt.seconds * 1000);
                const year = dateObj.getFullYear();
                const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                const day = String(dateObj.getDate()).padStart(2, '0');
                dateStr = `${goal.startDate} ~ ${year}.${month}.${day} ë‹¬ì„±`;
            }

            let timeBadgeHtml = '';
            if (goal.useTimeTracker) {
                const relatedRecords = records.filter(r => r.goalId === goal.id);
                const totalMinutes = relatedRecords.reduce((sum, r) => sum + (parseInt(r.time) || 0), 0);
                
                if (totalMinutes > 0) {
                    const h = Math.floor(totalMinutes / 60);
                    const m = totalMinutes % 60;
                    const timeStr = h > 0 ? `${h}ì‹œê°„ ${m}ë¶„` : `${m}ë¶„`;
                    timeBadgeHtml = `<div class="total-time-badge"><span>â±ï¸</span> <span>Total ${timeStr}</span></div>`;
                }
            }

            div.innerHTML = `
                ${catBadge}
                ${completedBadgeHtml}
                <div style="flex:1;" onclick="enterGoal('${goal.id}', '${goal.name}')">
                    <div class="card-title">
                        ${goal.name}
                    </div>
                    ${subHtml} 
                </div>
                <div class="card-actions" style="align-self: flex-start;">
                    <button class="icon-btn" onclick="editGoal('${goal.id}')" title="ìˆ˜ì •">${ICON_EDIT}</button>
                    <button class="icon-btn delete" onclick="deleteGoal('${goal.id}')" title="ì‚­ì œ">${ICON_DELETE}</button>
                </div>
                <div class="drag-handle">â‰¡</div>
                ${timeBadgeHtml}
                <div class="goal-date">${dateStr}</div>
                `;
            container.appendChild(div);
        });

        if(goalSortable) goalSortable.destroy();
        goalSortable = Sortable.create(container, {
            handle: '.drag-handle',
            animation: 150,
            ghostClass: 'sortable-ghost',
            onEnd: function (evt) {
                saveNewOrder(); // ìˆœì„œ ë³€ê²½ í›„ DB ì—…ë°ì´íŠ¸
            }
        });
    }

    function saveNewOrder() {
        const container = document.getElementById('goal-list-container');
        const items = container.querySelectorAll('.card');
        const batch = db.batch();
        let hasUpdates = false;

        items.forEach((item, index) => {
            const id = item.getAttribute('data-id');
            const newOrder = index + 1; 
            const goal = goals.find(g => g.id === id);
            if (goal && goal.order !== newOrder) {
                goal.order = newOrder;
                const ref = db.collection('goals').doc(id);
                batch.update(ref, { order: newOrder });
                hasUpdates = true;
            }
        });

        if (hasUpdates) {
            batch.commit().then(() => {
                console.log("ìˆœì„œ ì—…ë°ì´íŠ¸ ì™„ë£Œ");
            });
        }
    }

    function saveRecord() {
        const date = document.getElementById('record-date-input').value;
        const diary = document.getElementById('record-diary-input').value;
        const hourVal = document.getElementById('record-time-hour').value;
        const minVal = document.getElementById('record-time-minute').value;
        const totalMinutes = (parseInt(hourVal) || 0) * 60 + (parseInt(minVal) || 0);
        const id = document.getElementById('record-id-input').value;

        const checkedSubGoals = [];
        document.querySelectorAll('.subgoal-checkbox:checked').forEach(cb => {
            checkedSubGoals.push(cb.value);
        });

        if (!currentEmoji) return alert("ì˜¤ëŠ˜ì˜ ê¸°ë¶„(ì´ëª¨ì§€)ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");

        if (!id) {
            const exist = records.find(r => r.goalId === currentGoalId && r.date === date);
            if (exist) return alert("í•´ë‹¹ ë‚ ì§œì˜ ê¸°ë¡ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.");
        }

        const data = {
            uid: user.uid,
            goalId: currentGoalId,
            date: date,
            emoji: currentEmoji,
            diary: diary,
            completedSubGoals: checkedSubGoals,
            time: totalMinutes 
        };

        if (id) {
            db.collection('records').doc(id).update(data).then(() => {
                refreshCurrentView();
                closeModals();
            });
        } else {
            db.collection('records').add(data).then(() => {
                refreshCurrentView();
                closeModals();
            });
        }
    }

    function openRecordModal(id = null) {
        document.getElementById('modal-record').style.display = 'flex';
        const dateInput = document.getElementById('record-date-input');
        const diaryInput = document.getElementById('record-diary-input');
        const idInput = document.getElementById('record-id-input');
        const checkArea = document.getElementById('record-subgoal-area');
        const checkListDiv = document.getElementById('record-check-list');
        const timeInputArea = document.getElementById('record-time-input-area'); 
        
        const hourInput = document.getElementById('record-time-hour');
        const minInput = document.getElementById('record-time-minute');

        checkListDiv.innerHTML = '';
        selectEmoji('');
        
        const curGoal = goals.find(g => g.id === currentGoalId);
        if (curGoal && curGoal.useTimeTracker) {
            timeInputArea.style.display = 'block';
        } else {
            timeInputArea.style.display = 'none';
        }
        
        const mySubGoals = subGoalsMap[currentGoalId] || [];
        mySubGoals.sort((a,b) => (a.order||0) - (b.order||0));
        
        if(mySubGoals.length > 0) {
            checkArea.style.display = 'block';
            mySubGoals.forEach(sg => {
                const div = document.createElement('div');
                div.className = 'check-item';
                div.innerHTML = `
                    <label style="display:flex; align-items:center; width:100%; cursor:pointer;">
                        <input type="checkbox" class="subgoal-checkbox" value="${sg.id}">
                        <span><b>â€¢</b> ${sg.name}</span>
                    </label>
                `;
                checkListDiv.appendChild(div);
            });
        } else {
            checkArea.style.display = 'none';
        }

        if (id) {
            const rec = records.find(r => r.id === id);
            dateInput.value = rec.date; dateInput.disabled = true;
            diaryInput.value = rec.diary; idInput.value = rec.id;
            
            if (rec.time && rec.time > 0) {
                hourInput.value = Math.floor(rec.time / 60);
                minInput.value = rec.time % 60;
            } else {
                hourInput.value = '';
                minInput.value = '';
            }

            selectEmoji(rec.emoji);
            
            if(rec.completedSubGoals) {
                rec.completedSubGoals.forEach(subId => {
                    const cb = document.querySelector(`.subgoal-checkbox[value="${subId}"]`);
                    if(cb) cb.checked = true;
                });
            }
        } else {
            dateInput.valueAsDate = new Date(); dateInput.disabled = false;
            diaryInput.value = ''; idInput.value = '';
            hourInput.value = ''; minInput.value = ''; 
        }
    }

    function renderRecordList() {
        const container = document.getElementById('record-list-container');
        container.innerHTML = '';
        let myRecords = records.filter(r => r.goalId === currentGoalId);
        myRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
        const mySubGoals = subGoalsMap[currentGoalId] || [];

        if (myRecords.length === 0) {
            container.innerHTML = '<p style="text-align:center; color:#999; margin-top:80px; font-size:0.9rem;">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.<br>ì˜¤ëŠ˜ì˜ ê²°ê³¼ë¥¼ ê¸°ë¡í•´ë³´ì„¸ìš”!</p>';
            return;
        }
        myRecords.forEach(rec => {
            let emoji = rec.emoji === 'smile' ? 'ğŸ˜„' : rec.emoji === 'neutral' ? 'ğŸ˜' : 'ğŸ˜­';
            let styleClass = rec.emoji === 'smile' ? 'style-smile' : rec.emoji === 'neutral' ? 'style-neutral' : 'style-sad';
            
            let doneTagsHtml = '';
            if(rec.completedSubGoals && rec.completedSubGoals.length > 0) {
                doneTagsHtml = '<div class="subgoal-tags">';
                let doneSubs = [];
                rec.completedSubGoals.forEach(doneId => {
                    const foundSub = mySubGoals.find(sg => sg.id === doneId);
                    if(foundSub) doneSubs.push(foundSub);
                });
                doneSubs.sort((a,b) => (a.order||0) - (b.order||0));

                doneSubs.forEach(foundSub => {
                    doneTagsHtml += `<span class="subgoal-tag">âœ” ${foundSub.name}</span>`;
                });
                doneTagsHtml += '</div>';
            }

            let timeHtml = '';
            if (rec.time && rec.time > 0) {
                let h = Math.floor(rec.time / 60);
                let m = rec.time % 60;
                let timeText = '';
                if(h > 0) timeText += `${h}ì‹œê°„ `;
                if(m > 0) timeText += `${m}ë¶„`;
                timeHtml = `<span class="record-time-badge">â±ï¸ ${timeText.trim()}</span>`;
            }

            const div = document.createElement('div');
            div.className = `record-card ${styleClass}`; 
            
            div.innerHTML = `
                <div class="record-header">
                    <div>
                        <span>${rec.date}</span>
                        ${timeHtml}
                    </div>
                    <div>
                        <button class="icon-btn" onclick="editRecord('${rec.id}')" title="ìˆ˜ì •">${ICON_EDIT}</button>
                        <button class="icon-btn delete" onclick="deleteRecord('${rec.id}')" title="ì‚­ì œ">${ICON_DELETE}</button>
                    </div>
                </div>
                <div class="record-content">
                    <span class="emoji-display">${emoji}</span>
                    <div style="flex:1;">
                        <div class="record-text">${rec.diary}</div>
                    </div>
                </div>
                ${doneTagsHtml} 
                `;
            container.appendChild(div);
        });
    }

    function deleteRecord(id) {
        if(confirm("ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            db.collection('records').doc(id).delete().then(() => refreshCurrentView());
        }
    }

    function refreshCurrentView() {
        db.collection('records').where("uid", "==", user.uid).get().then((querySnapshot) => {
            records = [];
            querySnapshot.forEach((doc) => records.push({ id: doc.id, ...doc.data() }));
            
            if(document.getElementById('view-list').style.display === 'block') renderRecordList();
            else if(document.getElementById('view-calendar').style.display === 'block') renderCalendar();
            
            if(document.getElementById('screen-dashboard').style.display === 'block') renderDashboard();

            renderGoalList();
        });
    }

    function showScreen(screenName) {
        if (screenName === 'goal') {
            document.getElementById('screen-goal-list').style.display = 'block';
            document.getElementById('screen-record-list').style.display = 'none';
            document.getElementById('screen-dashboard').style.display = 'none';
            renderGoalList();
        } else if (screenName === 'dashboard') {
            document.getElementById('screen-goal-list').style.display = 'none';
            document.getElementById('screen-record-list').style.display = 'none';
            document.getElementById('screen-dashboard').style.display = 'block';
            renderDashboard();
        } else {
            document.getElementById('screen-goal-list').style.display = 'none';
            document.getElementById('screen-record-list').style.display = 'block';
            document.getElementById('screen-dashboard').style.display = 'none';
            switchTab('list');
        }
    }
    
    function switchTab(tabName) {
        if (tabName === 'list') {
            document.getElementById('view-list').style.display = 'block';
            document.getElementById('view-calendar').style.display = 'none';
            document.getElementById('tab-list-btn').classList.add('active');
            document.getElementById('tab-cal-btn').classList.remove('active');
            renderRecordList();
        } else {
            document.getElementById('view-list').style.display = 'none';
            document.getElementById('view-calendar').style.display = 'block';
            document.getElementById('tab-list-btn').classList.remove('active');
            document.getElementById('tab-cal-btn').classList.add('active');
            renderCalendar();
        }
    }

    function enterGoal(id, name) {
        currentGoalId = id;
        document.getElementById('record-title-text').innerText = name;
        showScreen('record');
    }
    function editGoal(id) { openGoalModal(id); }
    function editRecord(id) { openRecordModal(id); }
    
    function renderCalendar() {
        const container = document.getElementById('calendar-body');
        container.innerHTML = '';
        document.getElementById('cal-year-month').innerText = `${calYear}ë…„ ${calMonth + 1}ì›”`;
        const firstDay = new Date(calYear, calMonth, 1).getDay();
        const lastDate = new Date(calYear, calMonth + 1, 0).getDate();
        
        for (let i = 0; i < firstDay; i++) container.innerHTML += `<div class="cal-day"></div>`;
        
        for (let day = 1; day <= lastDate; day++) {
            const monthStr = (calMonth + 1).toString().padStart(2, '0');
            const dayStr = day.toString().padStart(2, '0');
            const dateStr = `${calYear}-${monthStr}-${dayStr}`;
            const record = records.find(r => r.goalId === currentGoalId && r.date === dateStr);
            let emojiHtml = record ? `<div class="cal-emoji">${record.emoji === 'smile' ? 'ğŸ˜„' : record.emoji === 'neutral' ? 'ğŸ˜' : 'ğŸ˜­'}</div>` : '';
            
            let timeHtml = '';
            if (record && record.time > 0) {
                let h = Math.floor(record.time / 60);
                let m = record.time % 60;
                let timeText = '';
                if(h > 0) timeText += `${h}h `;
                if(m > 0) timeText += `${m}m`;
                timeHtml = `<div class="cal-time">${timeText.trim()}</div>`;
            }

            const today = new Date();
            const isToday = today.getFullYear() === calYear && today.getMonth() === calMonth && today.getDate() === day;
            const bgStyle = isToday ? 'background:#000; color:white; border-radius:50%; width:20px; height:20px; display:flex; justify-content:center; align-items:center;' : '';
            container.innerHTML += `<div class="cal-day" onclick="handleCalendarClick('${dateStr}')"><span class="cal-date-num" style="${bgStyle}">${day}</span>${emojiHtml}${timeHtml}</div>`;
        }
        
        const summaryContainer = document.getElementById('calendar-summary');
        const curGoal = goals.find(g => g.id === currentGoalId);
        
        if (curGoal) {
            let dateRangeStr = `${curGoal.startDate || 'ì‹œì‘ì¼ ë¯¸ì •'} ~ ì§„í–‰ ì¤‘`;
            if (curGoal.completedAt) {
                const dateObj = curGoal.completedAt.toDate ? curGoal.completedAt.toDate() : new Date(curGoal.completedAt.seconds * 1000);
                const year = dateObj.getFullYear();
                const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                const day = String(dateObj.getDate()).padStart(2, '0');
                dateRangeStr = `${curGoal.startDate} ~ ${year}.${month}.${day} (ë‹¬ì„±)`;
            }

            let totalTimeStr = '-';
            if (curGoal.useTimeTracker) {
                const relatedRecords = records.filter(r => r.goalId === curGoal.id);
                const totalMinutes = relatedRecords.reduce((sum, r) => sum + (parseInt(r.time) || 0), 0);
                if (totalMinutes > 0) {
                    const h = Math.floor(totalMinutes / 60);
                    const m = totalMinutes % 60;
                    totalTimeStr = h > 0 ? `${h}ì‹œê°„ ${m}ë¶„` : `${m}ë¶„`;
                } else {
                    totalTimeStr = '0ë¶„';
                }
            } else {
                totalTimeStr = 'ì‹œê°„ ê¸°ë¡ ë¯¸ì‚¬ìš©';
            }

            summaryContainer.innerHTML = `
                <div class="summary-item">
                    <span class="summary-label">ê¸°ê°„</span>
                    <span class="summary-value date">${dateRangeStr}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">ì´ íˆ¬ì ì‹œê°„</span>
                    <span class="summary-value time">${totalTimeStr}</span>
                </div>
            `;
        }
    }
    
    function handleCalendarClick(dateStr) {
        const rec = records.find(r => r.goalId === currentGoalId && r.date === dateStr);
        if(rec) {
            openRecordModal(rec.id);
        } else {
            openRecordModal(null);
            document.getElementById('record-date-input').value = dateStr;
        }
    }

    function renderDashboard() {
        const table = document.getElementById('dash-table');
        table.innerHTML = '';
        
        document.getElementById('dash-year-month').innerText = `${dashYear}ë…„ ${dashMonth + 1}ì›”`;

        const lastDate = new Date(dashYear, dashMonth + 1, 0).getDate();
        let headerHtml = `<thead><tr><th class="sticky-col" style="z-index:10;">ëª©í‘œ</th>`;
        for (let d = 1; d <= lastDate; d++) {
            const dayOfWeek = new Date(dashYear, dashMonth, d).getDay();
            let color = '#555';
            if(dayOfWeek === 0) color = '#ef5350'; 
            if(dayOfWeek === 6) color = '#5c6bc0'; 
            headerHtml += `<th style="color:${color}">${d}</th>`;
        }
        headerHtml += `</tr></thead>`;
        table.innerHTML += headerHtml;

        let bodyHtml = `<tbody>`;
        
        const sortedGoals = [...goals].sort((a,b) => {
             const aDone = !!a.completedAt;
             const bDone = !!b.completedAt;
             if (aDone !== bDone) return aDone ? 1 : -1; 
             return (a.order||0) - (b.order||0);
        });

        sortedGoals.forEach(goal => {
            let monthTotalMin = 0;
            let tds = '';
            for (let d = 1; d <= lastDate; d++) {
                const monthStr = (dashMonth + 1).toString().padStart(2, '0');
                const dayStr = d.toString().padStart(2, '0');
                const dateStr = `${dashYear}-${monthStr}-${dayStr}`;

                const rec = records.find(r => r.goalId === goal.id && r.date === dateStr);
                
                let cellContent = '';
                if(rec) {
                    const emoji = rec.emoji === 'smile' ? 'ğŸ˜„' : rec.emoji === 'neutral' ? 'ğŸ˜' : 'ğŸ˜­';
                    cellContent = `<span class="dash-emoji">${emoji}</span>`;
                    monthTotalMin += (parseInt(rec.time) || 0);
                }
                tds += `<td class="dash-clickable-cell" onclick="handleDashClick('${goal.id}', '${dateStr}')">${cellContent}</td>`;
            }

            let timeText = '';
            if(goal.useTimeTracker) {
                if(monthTotalMin > 0) {
                    const h = Math.floor(monthTotalMin / 60);
                    const m = monthTotalMin % 60;
                    timeText = h > 0 ? `${h}h ${m}m` : `${m}m`;
                } else {
                    timeText = '0m';
                }
            }

            bodyHtml += `
                <tr>
                    <td class="sticky-col" onclick="enterGoal('${goal.id}', '${goal.name}')" title="ìƒì„¸ë³´ê¸°">
                        <span class="dash-goal-name">${goal.name}</span>
                        <span class="dash-total-time">${timeText}</span>
                    </td>
                    ${tds}
                </tr>
            `;
        });
        bodyHtml += `</tbody>`;
        table.innerHTML += bodyHtml;
    }

    function handleDashClick(goalId, dateStr) {
        currentGoalId = goalId; 
        const rec = records.find(r => r.goalId === goalId && r.date === dateStr);
        if(rec) {
            openRecordModal(rec.id);
        } else {
            openRecordModal(null);
            document.getElementById('record-date-input').value = dateStr;
        }
    }

    function changeDashMonth(diff) {
        dashMonth += diff;
        if (dashMonth > 11) { dashMonth = 0; dashYear++; } else if (dashMonth < 0) { dashMonth = 11; dashYear--; }
        renderDashboard();
    }

    function changeMonth(diff) {
        calMonth += diff;
        if (calMonth > 11) { calMonth = 0; calYear++; } else if (calMonth < 0) { calMonth = 11; calYear--; }
        renderCalendar();
    }
    function selectEmoji(mood) { currentEmoji = mood; ['smile', 'neutral', 'sad'].forEach(m => { document.getElementById('opt-' + m).classList.toggle('selected', m === mood); }); }
    function closeModals() { document.getElementById('modal-goal').style.display = 'none'; document.getElementById('modal-record').style.display = 'none'; }
</script>
</body>
</html>